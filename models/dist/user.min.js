"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var mongodb=require("mongodb"),getDb=require("../util/database").getDb,ObjectId=mongodb.ObjectId,User=function(){function n(e,t,r){_classCallCheck(this,n),this.name=e,this.name=t,this.cart=r}return _createClass(n,[{key:"save",value:function(){return getDb().collection("users").insertOne(this)}},{key:"addToCart",value:function(t){var e=this.cart.items.findIndex(function(e){return e.productId.toString()===t._id.toString()}),r=1,n=_toConsumableArray(this.cart.items);0<=e?(r=this.cart.items[e].quantity+1,n[e].quantity=r):n.push({productId:new ObjectId(t._id),quantity:r});var i={items:n};return getDb().collection("users").updateOne({_id:new ObjectId(this._id)},{$set:{cart:i}})}},{key:"getCart",value:function(){var r=this,e=getDb(),t=this.cart.items.map(function(e){return e.productId});return e.collection("products").find({_id:{$in:t}}).toArray().then(function(e){return e.map(function(t){return _objectSpread({},t,{quantity:r.cart.items.find(function(e){return e.productId.toString()===t._id.toString()}).quantity})})})}},{key:"deleteItemFromCart",value:function(t){var e=this.cart.items.filter(function(e){return e.productId.toString()!==t.toString()});return getDb().collection("users").updateOne({_id:new ObjectId(this._id)},{$set:{cart:{items:e}}})}},{key:"addOrder",value:function(){var t=this,r=getDb();return this.getCart().then(function(e){new ObjectId(t._id),t.name;return r.collection("orders").insertOne(t.cart)}).then(function(e){return t.cart={items:[]},r.collection("users").updateOne({_id:new ObjectId(t._id)},{$set:{cart:{items:[]}}})})}},{key:"getOrder",value:function(){return getDb().collection("orders").find({"user._id":new ObjectId(this._id)}).toArray()}}],[{key:"findById",value:function(e){return getDb().collection("users").findOne({_id:new ObjectId(e)}).then().catch(function(e){console.log(e)})}}]),n}();module.exports=User;
//# sourceMappingURL=user.min.js.map
