"use strict";var Product=require("../models/product");exports.getProducts=function(t,r,n){Product.findAll().then(function(t){r.render("shop/product-list",{prods:t,pageTitle:"All Products",path:"/products"})}).catch(function(t){console.log(t)})},exports.getProduct=function(t,r,n){var e=t.params.productId;Product.findByPk(e).then(function(t){r.render("shop/product-detail",{product:product,pageTitle:product.title,path:"/products"})}).catch(function(t){return console.log(t)})},exports.getIndex=function(t,r,n){Product.findAll().then(function(t){r.render("shop/index",{prods:t,pageTitle:"Shop",path:"/"})}).catch(function(t){console.log(t)})},exports.getCart=function(t,r,n){t.user.getCart().then(function(t){return t.getProducts().then(function(t){r.render("shop/cart",{path:"/cart",pageTitle:"Your Cart",products:t})}).catch(function(t){return console.log(t)})}).catch(function(t){return console.log(t)})},exports.postCart=function(t,r,n){var e,o=t.body.productId,c=1;t.user.getCart().then(function(t){return(e=t).getProducts({where:{id:o}})}).then(function(t){var r;if(0<t.length&&(r=t[0]),r){var n=r.cartItem.quantity;return c=n+1,r}return Product.findById(o)}).then(function(t){return e.addProduct(product,{through:{quantity:c}})}).then(function(){r.redirect("/cart")}).catch(function(t){return console.log(t)})},exports.postCartDeleteProduct=function(t,r,n){var e=t.body.productId;t.user.getCart().then(function(t){return t.getProducts({where:{id:e}})}).then(function(t){return t[0].cartItem.destroy()}).then(function(t){r.redirect("/cart")}).catch(function(t){return console.log(t)})},exports.postOrder=function(t,r,n){var e;t.user.getCart().then(function(t){return(e=t).getProducts()}).then(function(r){return t.user.createOrder().then(function(t){return t.addProducts(r.map(function(t){return t.orderItem={quantity:t.cartItem.quantity},t}))}).catch(function(t){return console.log(t)})}).then(function(t){return e.setProducts(null)}).then(function(t){r.redirect("/orders")}).catch(function(t){return console.log(t)})},exports.getOrders=function(t,r,n){t.user.getOrders({include:["products"]}).then(function(t){r.render("shop/orders",{path:"/orders",pageTitle:"Your Orders",orders:t})}).catch(function(t){return console.log(t)})};
//# sourceMappingURL=shop.min.js.map
