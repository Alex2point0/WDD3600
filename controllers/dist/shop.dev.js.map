{"version":3,"sources":["shop.js"],"names":["Product","require","exports","getProducts","req","res","next","findAll","then","products","render","prods","pageTitle","path","err","console","log","getProduct","prodId","params","productId","findByPk","product","title","getIndex","getCart","user","cart","postCart","body","fetchedCart","newQuantity","where","id","length","oldQuantity","cartItem","quantity","findById","data","addProduct","through","redirect","postCartDeleteProduct","destroy","result","postOrder","createOrder","order","addProducts","map","orderItem","setProducts","getOrders","include","orders"],"mappings":"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","sourcesContent":["// constant holding required product location\r\nconst Product = require('../models/product')\r\n\r\n// export function to get all products\r\nexports.getProducts = (req, res, next) => {\r\n  Product.findAll()\r\n    .then(products => {\r\n      res.render('shop/product-list', {\r\n        prods: products,\r\n        pageTitle: 'All Products',\r\n        path: '/products'\r\n      })\r\n    })\r\n    .catch(err => {\r\n      console.log(err)\r\n    })\r\n}\r\n\r\n// export function to get singular product\r\nexports.getProduct = (req, res, next) => {\r\n  const prodId = req.params.productId\r\n  Product.findByPk(prodId)\r\n    .then(products => {\r\n      res.render('shop/product-detail', {\r\n        product: product,\r\n        pageTitle: product.title,\r\n        path: '/products'\r\n      })\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n\r\n// export function to get content for shop page\r\nexports.getIndex = (req, res, next) => {\r\n  Product.findAll()\r\n    .then(products => {\r\n      res.render('shop/index', {\r\n        prods: products,\r\n        pageTitle: 'Shop',\r\n        path: '/'\r\n      })\r\n    })\r\n    .catch(err => {\r\n      console.log(err)\r\n    })\r\n}\r\n\r\n// export function to get content for cart page\r\nexports.getCart = (req, res, next) => {\r\n  req.user\r\n    .getCart()\r\n    .then(cart => {\r\n      return cart\r\n        .getProducts()\r\n        .then(products => {\r\n          res.render('shop/cart', {\r\n            path: '/cart',\r\n            pageTitle: 'Your Cart',\r\n            products: products\r\n          })\r\n        })\r\n        .catch(err => console.log(err))\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n\r\n// export function to get content for cart page\r\nexports.postCart = (req, res, next) => {\r\n  const prodId = req.body.productId\r\n  let fetchedCart\r\n  let newQuantity = 1\r\n  req.user\r\n    .getCart()\r\n    .then(cart => {\r\n      fetchedCart = cart\r\n      return cart.getProducts({ where: { id: prodId } })\r\n    })\r\n    .then(products => {\r\n      let product\r\n      if (products.length > 0) {\r\n        product = products[0]\r\n      }\r\n      if (product) {\r\n        const oldQuantity = product.cartItem.quantity\r\n        newQuantity = oldQuantity + 1\r\n        return product\r\n      }\r\n      return Product.findById(prodId)\r\n    })\r\n    .then(data => {\r\n      return fetchedCart.addProduct(product, {\r\n        through: { quantity: newQuantity }\r\n      })\r\n    })\r\n    .then(() => {\r\n      res.redirect('/cart')\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n\r\nexports.postCartDeleteProduct = (req, res, next) => {\r\n  const prodId = req.body.productId\r\n  req.user\r\n    .getCart()\r\n    .then(cart => {\r\n      return cart.getProducts({ where: { id: prodId } })\r\n    })\r\n    .then(products => {\r\n      const product = products[0]\r\n      return product.cartItem.destroy()\r\n    })\r\n    .then(result => {\r\n      res.redirect('/cart')\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n// something\r\nexports.postOrder = (req, res, next) => {\r\n  let fetchedCart\r\n  req.user\r\n    .getCart()\r\n    .then(cart => {\r\n      fetchedCart = cart\r\n      return cart.getProducts()\r\n    })\r\n    .then(products => {\r\n      return req.user\r\n        .createOrder()\r\n        .then(order => {\r\n          return order.addProducts(\r\n            products.map(product => {\r\n              product.orderItem = { quantity: product.cartItem.quantity }\r\n              return product\r\n            })\r\n          )\r\n        })\r\n        .catch(err => console.log(err))\r\n    })\r\n    .then(result => {\r\n      return fetchedCart.setProducts(null)\r\n    })\r\n    .then(result => {\r\n      res.redirect('/orders')\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n\r\n// export function to get content for orders page\r\nexports.getOrders = (req, res, next) => {\r\n  req.user\r\n    .getOrders({ include: ['products'] })\r\n    .then(orders => {\r\n      res.render('shop/orders', {\r\n        path: '/orders',\r\n        pageTitle: 'Your Orders',\r\n        orders: orders\r\n      })\r\n    })\r\n    .catch(err => console.log(err))\r\n}\r\n"],"file":"shop.dev.js"}